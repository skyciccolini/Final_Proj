---
title: "Ciccolini_Final_Proj"
author: "Skylar Ciccolini"
date: "2025-09-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Set Up

## Libraries, bring in data, etc
```{r}
library(tidyverse)
library(AICcmodavg)
library(lme4)
library(plotly)
library(gridExtra)
library(see)


# read in data

PF_adult_gridMET_2018_2023_BOI <- read_csv("Data/PF_adult_gridMET_2018_2023_BOI.csv")

# remove NAs
PF_adult_gridMET_2018_2023_BOI <- PF_adult_gridMET_2018_2023_BOI |> 
  filter(!is.na(Restime) & is.finite(Restime))

# read in data

TP_adult_gridMET_2018_2023_BOI <- read_csv("Data/TP_adult_gridMET_2018_2023_BOI.csv")

# remove NAs
TP_adult_gridMET_2018_2023_BOI <- TP_adult_gridMET_2018_2023_BOI %>%
  filter(!is.na(FireTime) & is.finite(FireTime))

# bring in custom theme
manuscript_theme <- list(
  theme_classic(),
  theme(axis.title = element_text(face = "bold", size = 12),
        axis.text = element_text(face = "italic", size = 10),
        text = element_text(family = "sans")),
  set.seed(898760))

```

## Models and predictions for Francisella 

```{r}

PF_Fran_climate_Restime_glm <- glm(data = PF_adult_gridMET_2018_2023_BOI, family = binomial,
                                  FrancisellaPresence~Restime + max_temp_summer : Mean_PDSI)

TP_Fran_climate_FireTime_glm <- glm(data = TP_adult_gridMET_2018_2023_BOI, family = binomial,
                                    FrancisellaPresence~FireTime + max_temp_summer : Mean_PDSI)

### update models with the ones below
TP_Fran_Res_climate_int_spp_glm <- glm(data = TP_adult_gridMET_2018_2023_BOI, family = binomial,
                                       FrancisellaPresence ~ FireTime*max_temp_summer + FireTime*Mean_PDSI + 
                                         max_temp_summer:Mean_PDSI + SPECIES)

TP_Rick_Res_climate_int_spp_glm <- glm(data = TP_adult_gridMET_2018_2023_BOI, family = binomial,
                                       RickettsiaPresence ~ FireTime*max_temp_summer + FireTime*Mean_PDSI + 
                                         max_temp_summer:Mean_PDSI + SPECIES)

PF_Fran_Res_climate_int_spp_glm <- glm(data = PF_adult_gridMET_2018_2023_BOI, family = binomial,
                                       FrancisellaPresence ~ Restime*max_temp_summer + Restime*Mean_PDSI + 
                                         max_temp_summer:Mean_PDSI + SPECIES)

PF_Rick_Res_climate_int_spp_glm <- glm(data = PF_adult_gridMET_2018_2023_BOI, family = binomial,
                                      RickettsiaPresence ~ Restime*max_temp_summer + Restime*Mean_PDSI + 
                                        max_temp_summer:Mean_PDSI + SPECIES)






# predicted values
PF_Fran_Restime_preds <- data.frame(
  Restime = seq(min(PF_adult_gridMET_2018_2023_BOI$Restime), max(PF_adult_gridMET_2018_2023_BOI$Restime), length.out = 100),
  max_temp_summer = mean(PF_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = mean(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

PF_Fran_Restime_preds$predicted_prob <- predict(PF_Fran_climate_Restime_glm, 
                                                newdata = PF_Fran_Restime_preds, type = "response")

#add std error
PF_Fran_Restime_preds$std_error <- with(PF_Fran_Restime_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Fran_Restime_preds$ci_lower <- PF_Fran_Restime_preds$predicted_prob - 1.96 * PF_Fran_Restime_preds$std_error
PF_Fran_Restime_preds$ci_upper <- PF_Fran_Restime_preds$predicted_prob + 1.96 * PF_Fran_Restime_preds$std_error



# Create a new data frame for predictions
PF_Fran_max_temp_summer_preds <- data.frame(
  Restime = mean(PF_adult_gridMET_2018_2023_BOI$Restime),
  max_temp_summer = seq(min(PF_adult_gridMET_2018_2023_BOI$max_temp_summer), max(PF_adult_gridMET_2018_2023_BOI$max_temp_summer), length.out = 100),
  Mean_PDSI = mean(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

# Add predicted probabilities
PF_Fran_max_temp_summer_preds$predicted_prob <- predict(PF_Fran_climate_Restime_glm, 
                                                        newdata = PF_Fran_max_temp_summer_preds, type = "response")

#add std error

PF_Fran_max_temp_summer_preds$std_error <- with(PF_Fran_max_temp_summer_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Fran_max_temp_summer_preds$ci_lower <- PF_Fran_max_temp_summer_preds$predicted_prob - 1.96 * PF_Fran_max_temp_summer_preds$std_error
PF_Fran_max_temp_summer_preds$ci_upper <- PF_Fran_max_temp_summer_preds$predicted_prob + 1.96 * PF_Fran_max_temp_summer_preds$std_error


# Create a new data frame for predictions
PF_Fran_Mean_PDSI_preds <- data.frame(
  Restime = mean(PF_adult_gridMET_2018_2023_BOI$Restime),
  max_temp_summer = mean(PF_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = seq(min(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI), max(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI), length.out = 100)
)

# Add predicted probabilities
PF_Fran_Mean_PDSI_preds$predicted_prob <- predict(PF_Fran_climate_Restime_glm, 
                                                  newdata = PF_Fran_Mean_PDSI_preds, type = "response")
#add std error

PF_Fran_Mean_PDSI_preds$std_error <- with(PF_Fran_Mean_PDSI_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Fran_Mean_PDSI_preds$ci_lower <- PF_Fran_Mean_PDSI_preds$predicted_prob - 1.96 * PF_Fran_Mean_PDSI_preds$std_error
PF_Fran_Mean_PDSI_preds$ci_upper <- PF_Fran_Mean_PDSI_preds$predicted_prob + 1.96 * PF_Fran_Mean_PDSI_preds$std_error




####################################################

# predicted values
TP_Fran_FireTime_preds <- data.frame(
  FireTime = seq(min(TP_adult_gridMET_2018_2023_BOI$FireTime), max(TP_adult_gridMET_2018_2023_BOI$FireTime), length.out = 100),
  max_temp_summer = mean(TP_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = mean(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

TP_Fran_FireTime_preds$predicted_prob <- predict(TP_Fran_climate_FireTime_glm, 
                                                 newdata = TP_Fran_FireTime_preds, type = "response")
#add std error

TP_Fran_FireTime_preds$std_error <- with(TP_Fran_FireTime_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Fran_FireTime_preds$ci_lower <- TP_Fran_FireTime_preds$predicted_prob - 1.96 * TP_Fran_FireTime_preds$std_error
TP_Fran_FireTime_preds$ci_upper <- TP_Fran_FireTime_preds$predicted_prob + 1.96 * TP_Fran_FireTime_preds$std_error



# Create a new data frame for predictions
TP_Fran_max_temp_summer_preds <- data.frame(
  FireTime = mean(TP_adult_gridMET_2018_2023_BOI$FireTime),
  max_temp_summer = seq(min(TP_adult_gridMET_2018_2023_BOI$max_temp_summer), max(TP_adult_gridMET_2018_2023_BOI$max_temp_summer), length.out = 100),
  Mean_PDSI = mean(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

# Add predicted probabilities
TP_Fran_max_temp_summer_preds$predicted_prob <- predict(TP_Fran_climate_FireTime_glm, 
                                                        newdata = TP_Fran_max_temp_summer_preds, type = "response")
#add std error

TP_Fran_max_temp_summer_preds$std_error <- with(TP_Fran_max_temp_summer_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Fran_max_temp_summer_preds$ci_lower <- TP_Fran_max_temp_summer_preds$predicted_prob - 1.96 * TP_Fran_max_temp_summer_preds$std_error
TP_Fran_max_temp_summer_preds$ci_upper <- TP_Fran_max_temp_summer_preds$predicted_prob + 1.96 * TP_Fran_max_temp_summer_preds$std_error



# Create a new data frame for predictions
TP_Fran_Mean_PDSI_preds <- data.frame(
  FireTime = mean(TP_adult_gridMET_2018_2023_BOI$FireTime),
  max_temp_summer = mean(TP_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = seq(min(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI), max(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI), length.out = 100)
)

# Add predicted probabilities
TP_Fran_Mean_PDSI_preds$predicted_prob <- predict(TP_Fran_climate_FireTime_glm, 
                                                  newdata = TP_Fran_Mean_PDSI_preds, type = "response")
#add std error

TP_Fran_Mean_PDSI_preds$std_error <- with(TP_Fran_Mean_PDSI_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Fran_Mean_PDSI_preds$ci_lower <- TP_Fran_Mean_PDSI_preds$predicted_prob - 1.96 * TP_Fran_Mean_PDSI_preds$std_error
TP_Fran_Mean_PDSI_preds$ci_upper <- TP_Fran_Mean_PDSI_preds$predicted_prob + 1.96 * TP_Fran_Mean_PDSI_preds$std_error




```


## Models and predictions for Rickettsia

```{r}

PF_Rick_climate_Restime_glm <- glm(data = PF_adult_gridMET_2018_2023_BOI, family = binomial,
                                  RickettsiaPresence~Restime + max_temp_summer : Mean_PDSI)

TP_Rick_climate_FireTime_glm <- glm(data = TP_adult_gridMET_2018_2023_BOI, family = binomial,
                                    RickettsiaPresence~FireTime + max_temp_summer : Mean_PDSI)


#plot predicted values
PF_Rick_Restime_preds <- data.frame(
  Restime = seq(min(PF_adult_gridMET_2018_2023_BOI$Restime), max(PF_adult_gridMET_2018_2023_BOI$Restime), length.out = 100),
  max_temp_summer = mean(PF_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = mean(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

PF_Rick_Restime_preds$predicted_prob <- predict(PF_Rick_climate_Restime_glm, 
                                                newdata = PF_Rick_Restime_preds, type = "response")

#add std error

PF_Rick_Restime_preds$std_error <- with(PF_Rick_Restime_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Rick_Restime_preds$ci_lower <- PF_Rick_Restime_preds$predicted_prob - 1.96 * PF_Rick_Restime_preds$std_error
PF_Rick_Restime_preds$ci_upper <- PF_Rick_Restime_preds$predicted_prob + 1.96 * PF_Rick_Restime_preds$std_error



# Create a new data frame for predictions
PF_Rick_max_temp_summer_preds <- data.frame(
  Restime = mean(PF_adult_gridMET_2018_2023_BOI$Restime),
  max_temp_summer = seq(min(PF_adult_gridMET_2018_2023_BOI$max_temp_summer), max(PF_adult_gridMET_2018_2023_BOI$max_temp_summer), length.out = 100),
  Mean_PDSI = mean(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

# Add predicted probabilities
PF_Rick_max_temp_summer_preds$predicted_prob <- predict(PF_Rick_climate_Restime_glm, 
                                                        newdata = PF_Rick_max_temp_summer_preds, type = "response")

#add std error

PF_Rick_max_temp_summer_preds$std_error <- with(PF_Rick_max_temp_summer_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Rick_max_temp_summer_preds$ci_lower <- PF_Rick_max_temp_summer_preds$predicted_prob - 1.96 * PF_Rick_max_temp_summer_preds$std_error
PF_Rick_max_temp_summer_preds$ci_upper <- PF_Rick_max_temp_summer_preds$predicted_prob + 1.96 * PF_Rick_max_temp_summer_preds$std_error


# Create a new data frame for predictions
PF_Rick_Mean_PDSI_preds <- data.frame(
  Restime = mean(PF_adult_gridMET_2018_2023_BOI$Restime),
  max_temp_summer = mean(PF_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = seq(min(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI), max(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI), length.out = 100)
)

# Add predicted probabilities
PF_Rick_Mean_PDSI_preds$predicted_prob <- predict(PF_Rick_climate_Restime_glm, 
                                                  newdata = PF_Rick_Mean_PDSI_preds, type = "response")


#add std error

PF_Rick_Mean_PDSI_preds$std_error <- with(PF_Rick_Mean_PDSI_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Rick_Mean_PDSI_preds$ci_lower <- PF_Rick_Mean_PDSI_preds$predicted_prob - 1.96 * PF_Rick_Mean_PDSI_preds$std_error
PF_Rick_Mean_PDSI_preds$ci_upper <- PF_Rick_Mean_PDSI_preds$predicted_prob + 1.96 * PF_Rick_Mean_PDSI_preds$std_error


#plot predicted values
TP_Rick_FireTime_preds <- data.frame(
  FireTime = seq(min(TP_adult_gridMET_2018_2023_BOI$FireTime), max(TP_adult_gridMET_2018_2023_BOI$FireTime), length.out = 100),
  max_temp_summer = mean(TP_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = mean(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

TP_Rick_FireTime_preds$predicted_prob <- predict(TP_Rick_climate_FireTime_glm, 
                                                 newdata = TP_Rick_FireTime_preds, type = "response")

#add std error

TP_Rick_FireTime_preds$std_error <- with(TP_Rick_FireTime_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Rick_FireTime_preds$ci_lower <- TP_Rick_FireTime_preds$predicted_prob - 1.96 * TP_Rick_FireTime_preds$std_error
TP_Rick_FireTime_preds$ci_upper <- TP_Rick_FireTime_preds$predicted_prob + 1.96 * TP_Rick_FireTime_preds$std_error


# Create a new data frame for predictions
TP_Rick_max_temp_summer_preds <- data.frame(
  FireTime = mean(TP_adult_gridMET_2018_2023_BOI$FireTime),
  max_temp_summer = seq(min(TP_adult_gridMET_2018_2023_BOI$max_temp_summer), max(TP_adult_gridMET_2018_2023_BOI$max_temp_summer), length.out = 100),
  Mean_PDSI = mean(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

# Add predicted probabilities
TP_Rick_max_temp_summer_preds$predicted_prob <- predict(TP_Rick_climate_FireTime_glm, 
                                                        newdata = TP_Rick_max_temp_summer_preds, type = "response")
#add std error

TP_Rick_max_temp_summer_preds$std_error <- with(TP_Rick_max_temp_summer_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Rick_max_temp_summer_preds$ci_lower <- TP_Rick_max_temp_summer_preds$predicted_prob - 1.96 * TP_Rick_max_temp_summer_preds$std_error
TP_Rick_max_temp_summer_preds$ci_upper <- TP_Rick_max_temp_summer_preds$predicted_prob + 1.96 * TP_Rick_max_temp_summer_preds$std_error



# Create a new data frame for predictions
TP_Rick_Mean_PDSI_preds <- data.frame(
  FireTime = mean(TP_adult_gridMET_2018_2023_BOI$FireTime),
  max_temp_summer = mean(TP_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = seq(min(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI), max(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI), length.out = 100)
)

# Add predicted probabilities
TP_Rick_Mean_PDSI_preds$predicted_prob <- predict(TP_Rick_climate_FireTime_glm, 
                                                  newdata = TP_Rick_Mean_PDSI_preds, type = "response")
#add std error

TP_Rick_Mean_PDSI_preds$std_error <- with(TP_Rick_Mean_PDSI_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Rick_Mean_PDSI_preds$ci_lower <- TP_Rick_Mean_PDSI_preds$predicted_prob - 1.96 * TP_Rick_Mean_PDSI_preds$std_error
TP_Rick_Mean_PDSI_preds$ci_upper <- TP_Rick_Mean_PDSI_preds$predicted_prob + 1.96 * TP_Rick_Mean_PDSI_preds$std_error






```


### Manuscript Figures

## Management figs with both bacterias
```{r}

# plot for reconstruction age with both bacterias

# Add a new column to each dataset
PF_Fran_Restime_preds$Pathogen <- "Francisella"
PF_Rick_Restime_preds$Pathogen <- "Rickettsia"

# Combine the datasets
PF_paths_combined_preds <- rbind(PF_Fran_Restime_preds, PF_Rick_Restime_preds)

# Updated ggplot
recon <- ggplot(PF_paths_combined_preds, aes(x = Restime, y = predicted_prob, linetype = Pathogen)) +
  geom_line() +
  geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper), alpha = 0.2) +
  xlab("Reconstruction Year") +
  ylab("Predicted Probability") +
  scale_linetype_manual(name = "Pathogen", 
                        labels = c(expression(italic("Francisella")),
                                   expression(italic("Rickettsia"))),
                        values = c("Francisella" = "dashed", "Rickettsia" = "solid")) +
  manuscript_theme

ggsave("Figs/Recon.jpg", plot = recon, units = "in",
       width = 6, height = 4)

### cant really add raw data because such different y scales of predicted plots and raw data?


# plot for fire with both bacterias

# Add a new column to each dataset
TP_Fran_FireTime_preds$Pathogen <- "Francisella"
TP_Rick_FireTime_preds$Pathogen <- "Rickettsia"

# Combine the datasets
TP_paths_combined_preds <- rbind(TP_Fran_FireTime_preds, TP_Rick_FireTime_preds)

# Updated ggplot
fire <- ggplot(TP_paths_combined_preds, aes(x = FireTime, y = predicted_prob, linetype = Pathogen)) +
  geom_line() +
  geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper), alpha = 0.2) +
  xlab("Time Since Fire") +
  ylab("Predicted Probability") +
  scale_linetype_manual(name = "Pathogen", 
                        labels = c(expression(italic("Francisella")),
                                   expression(italic("Rickettsia"))),
                        values = c("Francisella" = "dashed", "Rickettsia" = "solid")) +
  manuscript_theme


ggsave("Figs/Fire.jpg", plot = fire, units = "in",
       width = 6, height = 4)

```



## Cliamte figs with both sites with Francisella
```{r}
# plot for max summer temp with both sites

# Add a new column to each dataset
TP_Fran_max_temp_summer_preds$Site <- "Remnant"
PF_Fran_max_temp_summer_preds$Site <- "Reconstructed"

## we cant rbind here so instead
sum <- ggplot() +
  geom_line(data = TP_Fran_max_temp_summer_preds,
            aes(x = max_temp_summer, y = predicted_prob, linetype = Site)) +
  geom_ribbon(data = TP_Fran_max_temp_summer_preds,
              aes(x = max_temp_summer, y = predicted_prob,
                  ymin = ci_lower, ymax = ci_upper, linetype = Site),
              alpha = 0.2) +
  geom_line(data = PF_Fran_max_temp_summer_preds,
            aes(x = max_temp_summer, y = predicted_prob, linetype = Site)) +
  geom_ribbon(data = PF_Fran_max_temp_summer_preds,
              aes(x = max_temp_summer, y = predicted_prob,
                  ymin = ci_lower, ymax = ci_upper, linetype = Site),
              alpha = 0.2) +
  labs(x = expression("Nymphal Questing Max Summer Temperature (" * ~degree * C * ")"),
       y = "Predicted Probability") +
  manuscript_theme

ggsave("Figs/Sum.jpg", plot = sum, units = "in",
       width = 6, height = 4)

# lets try to make a secondary axis

# create a scaling factor in each dfs
scale_factor <- max(TP_Fran_max_temp_summer_preds$predicted_prob, na.rm = TRUE) / ## TP has bigger predicted probs
                max(PF_Fran_max_temp_summer_preds$predicted_prob, na.rm = TRUE) ## PF has smaller predicted probs

# create rescaled version of PF
PF_Fran_max_temp_summer_rescaled <- PF_Fran_max_temp_summer_preds

PF_Fran_max_temp_summer_rescaled$predicted_prob_scaled <-
  PF_Fran_max_temp_summer_rescaled$predicted_prob * scale_factor

PF_Fran_max_temp_summer_rescaled$ci_lower_scaled <-
  PF_Fran_max_temp_summer_rescaled$ci_lower * scale_factor

PF_Fran_max_temp_summer_rescaled$ci_upper_scaled <-
  PF_Fran_max_temp_summer_rescaled$ci_upper * scale_factor

# plot again with secondary axis
sum_2 <- ggplot() +
  geom_line(data = TP_Fran_max_temp_summer_preds,
            aes(x = max_temp_summer, y = predicted_prob, linetype = Site)) +
  geom_ribbon(data = TP_Fran_max_temp_summer_preds,
              aes(x = max_temp_summer, y = predicted_prob,
                  ymin = ci_lower, ymax = ci_upper, linetype = Site),
              alpha = 0.2) +
  geom_line(data = PF_Fran_max_temp_summer_rescaled,
            aes(x = max_temp_summer, y = predicted_prob_scaled, linetype = Site)) +
  geom_ribbon(data = PF_Fran_max_temp_summer_rescaled,
              aes(x = max_temp_summer, y = predicted_prob_scaled,
                  ymin = ci_lower_scaled, ymax = ci_upper_scaled, linetype = Site),
              alpha = 0.2) +
  scale_y_continuous(
    name = "Predicted Probability (Remnant)", ## name of primary y
    sec.axis = sec_axis(~ . / scale_factor, name = "Predicted Probability (Reconstructed)") ## name of secondary y
  ) +
  labs(x = expression("Nymphal Questing Max Summer Temperature (" * ~degree * C * ")")) +
  manuscript_theme


ggsave("Figs/sum2.jpg", plot = sum_2, units = "in",
       width = 6, height = 4)





# plot for pdsi

# Add a new column to each dataset
TP_Fran_Mean_PDSI_preds$Site <- "Remnant"
PF_Fran_Mean_PDSI_preds$Site <- "Reconstructed"

## we cant rbind here so instead
pdsi <- ggplot() +
  geom_line(data = TP_Fran_Mean_PDSI_preds,
            aes(x = Mean_PDSI, y = predicted_prob, linetype = Site)) +
  geom_ribbon(data = TP_Fran_Mean_PDSI_preds,
              aes(x = Mean_PDSI, y = predicted_prob,
                  ymin = ci_lower, ymax = ci_upper, linetype = Site),
              alpha = 0.2) +
  geom_line(data = PF_Fran_Mean_PDSI_preds,
            aes(x = Mean_PDSI, y = predicted_prob, linetype = Site)) +
  geom_ribbon(data = PF_Fran_Mean_PDSI_preds,
              aes(x = Mean_PDSI, y = predicted_prob,
                  ymin = ci_lower, ymax = ci_upper, linetype = Site),
              alpha = 0.2) +
  labs(x = "Average PDSI",
       y = "Predicted Probability") +
  manuscript_theme

ggsave("Figs/pdsi.jpg", plot = pdsi, units = "in",
       width = 6, height = 4)



```


### Oral Presentation Figure

```{r}
# map of field sites

library(ggmap)

# create map with prairie locs
locs <- tribble(~ lat, ~ lon, ~ ID,
                -91.7408, 38.8922, "Prairie Fork",
                -91.9902, 38.949, "Tucker")

# Create bounding box for locations
sbbox <- make_bbox(lon = locs$lon,
                   lat = locs$lat,
                   f = 0.25) # Expansion factor

# Download map
sq_map <- get_stamenmap(bbox = sbbox,
                        maptype = "terrain")

p <- ggmap(sq_map) + 
  geom_point(data = Locations,
             mapping = aes(x = lon, y = lat),
             color = "red",
             size = 3) +
  labs(x = "Longitude", y = "Latitude")
p


p +
  annotate(geom = "text",
           x = -92.45,
           y = 39.35,
           label = "Field Sites on the Missouri River",
           size = 8) +
  geom_text_repel(data = Locations,
                  mapping = aes(x = lon, y = lat, label = ID),
                  box.padding = 1,
                  seed = 431579)

# create map of US




# combine as inset
```



### Poster Presentation Figure

## PFCA positivity
```{r}

# plot for francisella positive cases over years
PF_Fran_pos <- PF_adult_gridMET_2018_2023_BOI |> 
  group_by(YEAR) |> 
  summarise(positives = sum(FrancisellaPresence),
            total = n())

PF_Fran_pos <- PF_Fran_pos |> 
  mutate(percent = (positives/total) * 100)



PF_Fran_pos <- ggplot() +
  geom_col(data = PF_Fran_pos, aes(x = YEAR, y = total), fill = "grey80") +
  geom_col(data = PF_Fran_pos, aes(x = YEAR, y = positives), fill = "red") +
  geom_text(data = PF_Fran_pos,
            aes(x = YEAR, y = positives, label = paste0(round(percent, 1), "%")),
            vjust = -0.5, fontface = "bold", color = "black") +
  labs(x = "Year", y = "Ticks Collected") +
  manuscript_theme

ggsave("Figs/PF_Fran_pos.jpg", plot = PF_Fran_pos, units = "in",
       width = 6, height = 4)

# plot for rickettsia presence over years
PF_Rick_pos <- PF_adult_gridMET_2018_2023_BOI |> 
  group_by(YEAR) |> 
  summarise(positives = sum(RickettsiaPresence),
            total = n())

PF_Rick_pos <- PF_Rick_pos |> 
  mutate(percent = (positives/total) * 100)



PF_Rick_pos <- ggplot() +
  geom_col(data = PF_Rick_pos, aes(x = YEAR, y = total), fill = "grey80") +
  geom_col(data = PF_Rick_pos, aes(x = YEAR, y = positives), fill = "red") +
  geom_text(data = PF_Rick_pos,
            aes(x = YEAR, y = positives, label = paste0(round(percent, 1), "%")),
            vjust = -0.5, fontface = "bold", color = "black") +
  labs(x = "Year", y = "Ticks Collected") +
  manuscript_theme ### probably should denote positives somehow

ggsave("Figs/PF_rick_pos.jpg", plot = PF_Rick_pos, units = "in",
       width = 6, height = 4)
```













