---
title: "Ciccolini_Final_Proj"
author: "Skylar Ciccolini"
date: "2025-09-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Set Up

## Libraries, bring in data, etc
```{r}
library(tidyverse)
library(AICcmodavg)
library(lme4)
library(plotly)
library(gridExtra)
library(see)


# read in data

PF_adult_gridMET_2018_2023_BOI <- read_csv("Data/PF_adult_gridMET_2018_2023_BOI.csv")

# remove NAs
PF_adult_gridMET_2018_2023_BOI <- PF_adult_gridMET_2018_2023_BOI |> 
  filter(!is.na(Restime) & is.finite(Restime))

# read in data

TP_adult_gridMET_2018_2023_BOI <- read_csv("Data/TP_adult_gridMET_2018_2023_BOI.csv")

# remove NAs
TP_adult_gridMET_2018_2023_BOI <- TP_adult_gridMET_2018_2023_BOI %>%
  filter(!is.na(FireTime) & is.finite(FireTime))

# bring in custom theme
manuscript_theme <- list(
  theme_classic(),
  theme(axis.title = element_text(face = "bold", size = 12),
        axis.text = element_text(face = "italic", size = 10),
        text = element_text(family = "Calibri")),
  set.seed(898760))

```

## Models and predictions for Francisella 

```{r}

PF_Fran_climate_Restime_glm <- glm(data = PF_adult_gridMET_2018_2023_BOI, family = binomial,
                                  FrancisellaPresence~Restime + max_temp_summer : Mean_PDSI)

TP_Fran_climate_FireTime_glm <- glm(data = TP_adult_gridMET_2018_2023_BOI, family = binomial,
                                    FrancisellaPresence~FireTime + max_temp_summer : Mean_PDSI)



# predicted values
PF_Fran_Restime_preds <- data.frame(
  Restime = seq(min(PF_adult_gridMET_2018_2023_BOI$Restime), max(PF_adult_gridMET_2018_2023_BOI$Restime), length.out = 100),
  max_temp_summer = mean(PF_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = mean(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

PF_Fran_Restime_preds$predicted_prob <- predict(PF_Fran_climate_Restime_glm, 
                                                newdata = PF_Fran_Restime_preds, type = "response")

#add std error
PF_Fran_Restime_preds$std_error <- with(PF_Fran_Restime_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Fran_Restime_preds$ci_lower <- PF_Fran_Restime_preds$predicted_prob - 1.96 * PF_Fran_Restime_preds$std_error
PF_Fran_Restime_preds$ci_upper <- PF_Fran_Restime_preds$predicted_prob + 1.96 * PF_Fran_Restime_preds$std_error



# Create a new data frame for predictions
PF_Fran_max_temp_summer_preds <- data.frame(
  Restime = mean(PF_adult_gridMET_2018_2023_BOI$Restime),
  max_temp_summer = seq(min(PF_adult_gridMET_2018_2023_BOI$max_temp_summer), max(PF_adult_gridMET_2018_2023_BOI$max_temp_summer), length.out = 100),
  Mean_PDSI = mean(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

# Add predicted probabilities
PF_Fran_max_temp_summer_preds$predicted_prob <- predict(PF_Fran_climate_Restime_glm, 
                                                        newdata = PF_Fran_max_temp_summer_preds, type = "response")

#add std error

PF_Fran_max_temp_summer_preds$std_error <- with(PF_Fran_max_temp_summer_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Fran_max_temp_summer_preds$ci_lower <- PF_Fran_max_temp_summer_preds$predicted_prob - 1.96 * PF_Fran_max_temp_summer_preds$std_error
PF_Fran_max_temp_summer_preds$ci_upper <- PF_Fran_max_temp_summer_preds$predicted_prob + 1.96 * PF_Fran_max_temp_summer_preds$std_error


# Create a new data frame for predictions
PF_Fran_Mean_PDSI_preds <- data.frame(
  Restime = mean(PF_adult_gridMET_2018_2023_BOI$Restime),
  max_temp_summer = mean(PF_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = seq(min(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI), max(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI), length.out = 100)
)

# Add predicted probabilities
PF_Fran_Mean_PDSI_preds$predicted_prob <- predict(PF_Fran_climate_Restime_glm, 
                                                  newdata = PF_Fran_Mean_PDSI_preds, type = "response")
#add std error

PF_Fran_Mean_PDSI_preds$std_error <- with(PF_Fran_Mean_PDSI_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Fran_Mean_PDSI_preds$ci_lower <- PF_Fran_Mean_PDSI_preds$predicted_prob - 1.96 * PF_Fran_Mean_PDSI_preds$std_error
PF_Fran_Mean_PDSI_preds$ci_upper <- PF_Fran_Mean_PDSI_preds$predicted_prob + 1.96 * PF_Fran_Mean_PDSI_preds$std_error




####################################################

# predicted values
TP_Fran_FireTime_preds <- data.frame(
  FireTime = seq(min(TP_adult_gridMET_2018_2023_BOI$FireTime), max(TP_adult_gridMET_2018_2023_BOI$FireTime), length.out = 100),
  max_temp_summer = mean(TP_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = mean(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

TP_Fran_FireTime_preds$predicted_prob <- predict(TP_Fran_climate_FireTime_glm, 
                                                 newdata = TP_Fran_FireTime_preds, type = "response")
#add std error

TP_Fran_FireTime_preds$std_error <- with(TP_Fran_FireTime_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Fran_FireTime_preds$ci_lower <- TP_Fran_FireTime_preds$predicted_prob - 1.96 * TP_Fran_FireTime_preds$std_error
TP_Fran_FireTime_preds$ci_upper <- TP_Fran_FireTime_preds$predicted_prob + 1.96 * TP_Fran_FireTime_preds$std_error



# Create a new data frame for predictions
TP_Fran_max_temp_summer_preds <- data.frame(
  FireTime = mean(TP_adult_gridMET_2018_2023_BOI$FireTime),
  max_temp_summer = seq(min(TP_adult_gridMET_2018_2023_BOI$max_temp_summer), max(TP_adult_gridMET_2018_2023_BOI$max_temp_summer), length.out = 100),
  Mean_PDSI = mean(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

# Add predicted probabilities
TP_Fran_max_temp_summer_preds$predicted_prob <- predict(TP_Fran_climate_FireTime_glm, 
                                                        newdata = TP_Fran_max_temp_summer_preds, type = "response")
#add std error

TP_Fran_max_temp_summer_preds$std_error <- with(TP_Fran_max_temp_summer_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Fran_max_temp_summer_preds$ci_lower <- TP_Fran_max_temp_summer_preds$predicted_prob - 1.96 * TP_Fran_max_temp_summer_preds$std_error
TP_Fran_max_temp_summer_preds$ci_upper <- TP_Fran_max_temp_summer_preds$predicted_prob + 1.96 * TP_Fran_max_temp_summer_preds$std_error



# Create a new data frame for predictions
TP_Fran_Mean_PDSI_preds <- data.frame(
  FireTime = mean(TP_adult_gridMET_2018_2023_BOI$FireTime),
  max_temp_summer = mean(TP_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = seq(min(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI), max(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI), length.out = 100)
)

# Add predicted probabilities
TP_Fran_Mean_PDSI_preds$predicted_prob <- predict(TP_Fran_climate_FireTime_glm, 
                                                  newdata = TP_Fran_Mean_PDSI_preds, type = "response")
#add std error

TP_Fran_Mean_PDSI_preds$std_error <- with(TP_Fran_Mean_PDSI_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Fran_Mean_PDSI_preds$ci_lower <- TP_Fran_Mean_PDSI_preds$predicted_prob - 1.96 * TP_Fran_Mean_PDSI_preds$std_error
TP_Fran_Mean_PDSI_preds$ci_upper <- TP_Fran_Mean_PDSI_preds$predicted_prob + 1.96 * TP_Fran_Mean_PDSI_preds$std_error




```


## Models and predictions for Rickettsia

```{r}

PF_Rick_climate_Restime_glm <- glm(data = PF_adult_gridMET_2018_2023_BOI, family = binomial,
                                  RickettsiaPresence~Restime + max_temp_summer : Mean_PDSI)

TP_Rick_climate_FireTime_glm <- glm(data = TP_adult_gridMET_2018_2023_BOI, family = binomial,
                                    RickettsiaPresence~FireTime + max_temp_summer : Mean_PDSI)


#plot predicted values
PF_Rick_Restime_preds <- data.frame(
  Restime = seq(min(PF_adult_gridMET_2018_2023_BOI$Restime), max(PF_adult_gridMET_2018_2023_BOI$Restime), length.out = 100),
  max_temp_summer = mean(PF_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = mean(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

PF_Rick_Restime_preds$predicted_prob <- predict(PF_Rick_climate_Restime_glm, 
                                                newdata = PF_Rick_Restime_preds, type = "response")

#add std error

PF_Rick_Restime_preds$std_error <- with(PF_Rick_Restime_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Rick_Restime_preds$ci_lower <- PF_Rick_Restime_preds$predicted_prob - 1.96 * PF_Rick_Restime_preds$std_error
PF_Rick_Restime_preds$ci_upper <- PF_Rick_Restime_preds$predicted_prob + 1.96 * PF_Rick_Restime_preds$std_error



# Create a new data frame for predictions
PF_Rick_max_temp_summer_preds <- data.frame(
  Restime = mean(PF_adult_gridMET_2018_2023_BOI$Restime),
  max_temp_summer = seq(min(PF_adult_gridMET_2018_2023_BOI$max_temp_summer), max(PF_adult_gridMET_2018_2023_BOI$max_temp_summer), length.out = 100),
  Mean_PDSI = mean(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

# Add predicted probabilities
PF_Rick_max_temp_summer_preds$predicted_prob <- predict(PF_Rick_climate_Restime_glm, 
                                                        newdata = PF_Rick_max_temp_summer_preds, type = "response")

#add std error

PF_Rick_max_temp_summer_preds$std_error <- with(PF_Rick_max_temp_summer_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Rick_max_temp_summer_preds$ci_lower <- PF_Rick_max_temp_summer_preds$predicted_prob - 1.96 * PF_Rick_max_temp_summer_preds$std_error
PF_Rick_max_temp_summer_preds$ci_upper <- PF_Rick_max_temp_summer_preds$predicted_prob + 1.96 * PF_Rick_max_temp_summer_preds$std_error


# Create a new data frame for predictions
PF_Rick_Mean_PDSI_preds <- data.frame(
  Restime = mean(PF_adult_gridMET_2018_2023_BOI$Restime),
  max_temp_summer = mean(PF_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = seq(min(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI), max(PF_adult_gridMET_2018_2023_BOI$Mean_PDSI), length.out = 100)
)

# Add predicted probabilities
PF_Rick_Mean_PDSI_preds$predicted_prob <- predict(PF_Rick_climate_Restime_glm, 
                                                  newdata = PF_Rick_Mean_PDSI_preds, type = "response")


#add std error

PF_Rick_Mean_PDSI_preds$std_error <- with(PF_Rick_Mean_PDSI_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
PF_Rick_Mean_PDSI_preds$ci_lower <- PF_Rick_Mean_PDSI_preds$predicted_prob - 1.96 * PF_Rick_Mean_PDSI_preds$std_error
PF_Rick_Mean_PDSI_preds$ci_upper <- PF_Rick_Mean_PDSI_preds$predicted_prob + 1.96 * PF_Rick_Mean_PDSI_preds$std_error


#plot predicted values
TP_Rick_FireTime_preds <- data.frame(
  FireTime = seq(min(TP_adult_gridMET_2018_2023_BOI$FireTime), max(TP_adult_gridMET_2018_2023_BOI$FireTime), length.out = 100),
  max_temp_summer = mean(TP_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = mean(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

TP_Rick_FireTime_preds$predicted_prob <- predict(TP_Rick_climate_FireTime_glm, 
                                                 newdata = TP_Rick_FireTime_preds, type = "response")

#add std error

TP_Rick_FireTime_preds$std_error <- with(TP_Rick_FireTime_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Rick_FireTime_preds$ci_lower <- TP_Rick_FireTime_preds$predicted_prob - 1.96 * TP_Rick_FireTime_preds$std_error
TP_Rick_FireTime_preds$ci_upper <- TP_Rick_FireTime_preds$predicted_prob + 1.96 * TP_Rick_FireTime_preds$std_error


# Create a new data frame for predictions
TP_Rick_max_temp_summer_preds <- data.frame(
  FireTime = mean(TP_adult_gridMET_2018_2023_BOI$FireTime),
  max_temp_summer = seq(min(TP_adult_gridMET_2018_2023_BOI$max_temp_summer), max(TP_adult_gridMET_2018_2023_BOI$max_temp_summer), length.out = 100),
  Mean_PDSI = mean(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI)
)

# Add predicted probabilities
TP_Rick_max_temp_summer_preds$predicted_prob <- predict(TP_Rick_climate_FireTime_glm, 
                                                        newdata = TP_Rick_max_temp_summer_preds, type = "response")
#add std error

TP_Rick_max_temp_summer_preds$std_error <- with(TP_Rick_max_temp_summer_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Rick_max_temp_summer_preds$ci_lower <- TP_Rick_max_temp_summer_preds$predicted_prob - 1.96 * TP_Rick_max_temp_summer_preds$std_error
TP_Rick_max_temp_summer_preds$ci_upper <- TP_Rick_max_temp_summer_preds$predicted_prob + 1.96 * TP_Rick_max_temp_summer_preds$std_error



# Create a new data frame for predictions
TP_Rick_Mean_PDSI_preds <- data.frame(
  FireTime = mean(TP_adult_gridMET_2018_2023_BOI$FireTime),
  max_temp_summer = mean(TP_adult_gridMET_2018_2023_BOI$max_temp_summer),
  Mean_PDSI = seq(min(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI), max(TP_adult_gridMET_2018_2023_BOI$Mean_PDSI), length.out = 100)
)

# Add predicted probabilities
TP_Rick_Mean_PDSI_preds$predicted_prob <- predict(TP_Rick_climate_FireTime_glm, 
                                                  newdata = TP_Rick_Mean_PDSI_preds, type = "response")
#add std error

TP_Rick_Mean_PDSI_preds$std_error <- with(TP_Rick_Mean_PDSI_preds, sd(predicted_prob) / sqrt(length(predicted_prob)))
TP_Rick_Mean_PDSI_preds$ci_lower <- TP_Rick_Mean_PDSI_preds$predicted_prob - 1.96 * TP_Rick_Mean_PDSI_preds$std_error
TP_Rick_Mean_PDSI_preds$ci_upper <- TP_Rick_Mean_PDSI_preds$predicted_prob + 1.96 * TP_Rick_Mean_PDSI_preds$std_error






```


### Manuscript Figures

```{r}

# plot for reconstruction age with both bacterias

# Add a new column to each dataset
PF_Fran_Restime_preds$Pathogen <- "Francisella"
PF_Rick_Restime_preds$Pathogen <- "Rickettsia"

# Combine the datasets
combined_preds <- rbind(PF_Fran_Restime_preds, PF_Rick_Restime_preds)

# Updated ggplot
ggplot(combined_preds, aes(x = Restime, y = predicted_prob, linetype = Pathogen)) +
  geom_line() +
  geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper), alpha = 0.2) +
  xlab("Reconstruction Year") +
  ylab("Predicted Probability") +
  scale_linetype_manual(name = "Pathogen", 
                        labels = c(expression(italic("Francisella")),
                                   expression(italic("Rickettsia"))),
                        values = c("Francisella" = "dashed", "Rickettsia" = "solid")) +
  manuscript_theme






### cant really add raw data because such different y scales?


# plot for fire with both bacterias



# plot for max summer temp



# plot for pdsi

```


### Oral Presentation Figure

```{r}
# map of field sites


```



### Poster Presentation Figure

```{r}

# plot for francisella positive cases over years
PF_Fran_pos <- PF_adult_gridMET_2018_2023_BOI |> 
  group_by(YEAR) |> 
  summarise(positives = sum(FrancisellaPresence),
            total = nrow(PF_adult_gridMET_2018_2023_BOI))

PF_Fran_pos <- PF_Fran_pos |> 
  mutate(percent = (positives/total) * 100)



ggplot() +
  geom_point(data = PF_Fran_pos, aes(x = YEAR, y = percent)) #### HEY YOU WERE HERE

# plot for rickettsia presence over years


```

















